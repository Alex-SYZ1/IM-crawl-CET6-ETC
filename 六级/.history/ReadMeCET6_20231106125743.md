## [四六级网站](https://pan.uvooc.com/)内容爬取并半自动化分类（可应用于本网站其他资源，除部分非免费开放资源）

### 一、目录文件
```
./CET6真题及答案/:  
以年份为文件夹，每文件夹下为真题、解析或真题及解析文件  
A开头为真题/真题及解析，Z开头为解析
卷0/1/2/3分别表示合卷、卷一、卷二、卷三  

./CET6真题的配套听力/:  
以年份为文件夹，每文件夹下为听力mp3，相对路径与真题文件夹路径对应  

./官方要求/:  
含最新大纲pdf与简版考试内容图片

./模拟题/:
含听力、阅读模拟题、押题  

./其他资料/:
    ./其他资料/作文模板/
    ./其他资料/听力技巧/
    ./其他资料/经验分享/
    ./其他资料/词汇/
    ./其他资料/阅读资料/:阅读题目及美文

./Z-codes/:内容爬取并半自动化分类 实现代码
    ./Z-codes/Sele_getfiles.ipynb/:爬取内容
    ./Z-codes/split.ipynb:半自动化分类

./ReadMeCET6.md:本介绍文档  
```
### 二、代码
### **爬取内容**
#### 1.运行环境

+ python版本：3.9.18  
+ Module:
   + selenium(使用的Edge driver)
   + time
   + queue
   + pyperclip
   + os
   + subprocess
   + psutil
+ (设置edge_options是为使sele使用已有账户的信息运行浏览器)
#### 2.基本思路
##### 2.1 由于该网站内容呈现目录化前端，各个内容的链接通过右击按钮能复制链接。故：  
+ 创建driver对象，使用driver逐级访问各级目录链接，获取其下目录链接存储入栈，不断循环出栈入栈操作，直到栈为空停止访问。
##### 2.2 考虑点：
###### 2.2.1  网站呈现目录形式，文件夹按钮左键点击后是进入下一级，而不是直接的下载链接；  
+ 文件按钮左键点击后是在该网站呈现该内容(汗...)，但二者通过右击按钮能复制链接：  
+ 通过右键点击的复制链接功能，存储所有链接。  
    - 如果链接中包含?的请求信息，则为下载文件链接，直接访问即可下载；
    - 反之，为下级目录链接，则继续访问，继续获取目录下链接。

###### 2.2.2 通过 **在Edge设置下载方式为直接下载无需确认** 来实现批量下载，但全部文件都下载在一个文件夹，非常杂乱；  
+ 要实现对网站上内容目录层次的复刻：  
     + 先为根链接手动输入对应的文件名，存入 url_text字典并在本地创建文件夹；
     + 在逐级获取链接入栈时，即通过os.path.join(parent_path,element.text)的方法迭代生成各文件、文件夹的路径,保存在url_text字典中；
     + 在访问栈内链接时，据url_text的索引获得其路径：  
        若为文件夹，则创建路径对应的本地文件夹；  
        若为文件，则先下载至浏览器默认路径，然后移动至对应路径。  
        (暂时未找到  **获取浏览器某一下载链接对应下载任务的状况、路径/使用sele设置下载的文件名称的方法**   
        故使用下载任务限行为1、通过**默认文件夹下的单个文件后缀正确**为标准判断下载任务结束，结束后将这个唯一的文件移动至url_text中存储的对应路径名  
        缺点是下载时代码一直等待，无法继续下一个文件/文件夹链接的访问)  

 
###### 2.2.3  网站需要缓慢向下翻页加载剩余内容，且直接翻至底部无法加载页面中部的内容；
+   借用了ChatGPT的思路，持续模拟"PageDown"按键操作，设置time.sleep的休眠时间用于加载内容，当当前位置与上一次滚动的位置相同时，则已翻动至页面最底部，内容已全部加载完毕。
###### 2.2.4 运行时，弹出的提示框挡住了控件，无法点击控件：
+ 因弹框出现数秒即消失，F12检测其相关属性略微不方便，故采取惹不起等得起策略，判断弹框所在frame的文本出现"通知"即为弹框出现，文本无"通知"即为弹框消失，然后继续后续操作。  
(也考虑过将点击按钮位置进行调整，比较离谱所以放弃；主要原因还是不会暂停弹框消失的js运行然后找到弹框关闭键的相关属性，不然可检测弹框的关闭键并自动点击)  


### **个性化重命名、组织文件**
+ 初始测试：文件名内以“卷一”形式标记，文件目录不会按照一二三排序，可更名为卷1/2/3，并注明年月日，将每年的题目&答案、听力分别放置于两个文件夹 
+ 最终：大致满足此目标，但也有许多手动操作，因文件名不标准化。


